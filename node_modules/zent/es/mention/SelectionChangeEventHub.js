import findIndex from 'lodash-es/findIndex';
import isEmpty from 'lodash-es/isEmpty';
import isFirefox from '../utils/isFirefox';
var gEventRegistered = false;
var subscriberList = [];
export function install(config) {
    if (!gEventRegistered) {
        if (isFirefox) {
            document.addEventListener('click', onDocumentSelectionChange, true);
        }
        else {
            document.addEventListener('selectionchange', onDocumentSelectionChange);
        }
    }
    var idx = findIndex(subscriberList, config);
    if (idx === -1) {
        subscriberList.push(config);
    }
}
export function uninstall(config) {
    var idx = findIndex(subscriberList, config);
    subscriberList.splice(idx, 1);
    if (isEmpty(subscriberList)) {
        if (isFirefox) {
            document.removeEventListener('click', onDocumentSelectionChange, true);
        }
        else {
            document.removeEventListener('selectionchange', onDocumentSelectionChange);
        }
    }
}
function onDocumentSelectionChange(evt) {
    var activeElement = document.activeElement;
    var matchedSubscriberIndex = findIndex(subscriberList, {
        node: activeElement,
    });
    if (matchedSubscriberIndex !== -1) {
        subscriberList[matchedSubscriberIndex].callback(evt);
    }
}
